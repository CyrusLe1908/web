<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng điều khiển - Hệ thống xử án RLIFE</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
</head>
<body class="flex flex-col min-h-screen dashboard-background">
    <header class="bg-gray-800 shadow-md py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-yellow-400">HỆ THỐNG XỬ ÁN RLIFE</h1>
            <nav>
                <ul class="flex space-x-4 items-center">
                    <li><span class="text-gray-300">Xin chào, {{ session.username }}!</span></li>
                    {% if is_admin %}
                        <li><span class="text-yellow-400 font-semibold">(Quản trị viên)</span></li>
                    {% endif %}
                    <li>
                        <a href="{{ url_for('logout') }}" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                            Đăng xuất
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-4">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <h2 class="text-3xl font-bold text-yellow-400 mb-6">Bảng điều khiển</h2>

        {% if is_admin %}
            <div class="bg-gray-800 p-6 rounded-lg shadow-xl mb-8">
                <h3 class="text-2xl font-semibold text-gray-200 mb-4">Thêm người dùng mới</h3>
                <form action="{{ url_for('add_user') }}" method="POST" class="space-y-4">
                    <div>
                        <label for="new_username" class="block text-gray-400 text-sm font-medium mb-2">Tên đăng nhập mới</label>
                        <input type="text" id="new_username" name="username" placeholder="Nhập tên đăng nhập" required
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-yellow-500 text-white placeholder-gray-400">
                    </div>
                    <div>
                        <label for="new_password" class="block text-gray-400 text-sm font-medium mb-2">Mật khẩu</label>
                        <input type="password" id="new_password" name="password" placeholder="Nhập mật khẩu" required
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-yellow-500 text-white placeholder-gray-400">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="is_admin_new_user" name="is_admin_new_user"
                               class="h-4 w-4 text-yellow-500 focus:ring-yellow-400 border-gray-600 rounded">
                        <label for="is_admin_new_user" class="ml-2 block text-gray-400 text-sm">Cấp quyền quản trị viên</label>
                    </div>
                    <button type="submit"
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                        Thêm người dùng
                    </button>
                </form>
            </div>

            <div class="bg-gray-800 p-6 rounded-lg shadow-xl mb-8">
                <h3 class="text-2xl font-semibold text-gray-200 mb-4">Quản lý người dùng hiện có</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-gray-700 rounded-lg overflow-hidden">
                        <thead class="bg-gray-600">
                            <tr>
                                <th class="py-3 px-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ID</th>
                                <th class="py-3 px-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Tên đăng nhập</th>
                                <th class="py-3 px-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Là Admin</th>
                                <th class="py-3 px-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Hành động</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-600">
                            {% for user in users %}
                                <tr class="hover:bg-gray-600">
                                    <td class="py-3 px-4 whitespace-nowrap">{{ user['id'] }}</td> {# Changed from user.id #}
                                    <td class="py-3 px-4 whitespace-nowrap">{{ user['username'] }}</td> {# Changed from user.username #}
                                    <td class="py-3 px-4 whitespace-nowrap">
                                        {% if user['is_admin'] %} {# Changed from user.is_admin #}
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Có</span>
                                        {% else %}
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Không</span>
                                        {% endif %}
                                    </td>
                                    <td class="py-3 px-4 whitespace-nowrap flex space-x-2">
                                        {# Check if the user is not the current session user OR if there's more than one admin #}
                                        {% if user['id'] != session.user_id or users|selectattr('is_admin')|list|length > 1 %}
                                            <form action="{{ url_for('toggle_admin', user_id=user['id']) }}" method="POST" class="inline-block"> {# Changed from user.id #}
                                                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded-md text-sm transition duration-300">
                                                    {% if user['is_admin'] %}Hạ cấp{% else %}Thăng cấp{% endif %} {# Changed from user.is_admin #}
                                                </button>
                                            </form>
                                            <form action="{{ url_for('delete_user', user_id=user['id']) }}" method="POST" class="inline-block" onsubmit="return confirm('Bạn có chắc chắn muốn xóa người dùng này?');"> {# Changed from user.id #}
                                                <button type="submit" class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-md text-sm transition duration-300">
                                                    Xóa
                                                </button>
                                            </form>
                                        {% else %}
                                            <span class="text-gray-400 text-sm">Không thể chỉnh sửa</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Placeholder for other management sections based on image_e0c23d.jpg -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-xl mb-8">
                <h3 class="text-2xl font-semibold text-gray-200 mb-4">Quản lý Mục khác (Placeholder)</h3>
                <p class="text-gray-400">
                    Đây là nơi bạn có thể thêm các phần quản lý khác như "Tội danh", "Hệ thống xử án", v.v., dựa trên yêu cầu của bạn.
                    Hiện tại, đây chỉ là một placeholder.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-200 mb-2">Mục 1 - Vi phạm IT</h4>
                        <p class="text-gray-400 text-sm">Quản lý các loại vi phạm công nghệ thông tin.</p>
                        <button class="mt-3 bg-yellow-500 hover:bg-yellow-600 text-gray-900 py-2 px-4 rounded-md text-sm">Xem chi tiết</button>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-200 mb-2">Mục 2 - Hồ sơ</h4>
                        <p class="text-gray-400 text-sm">Quản lý hồ sơ tội phạm và người dùng.</p>
                        <button class="mt-3 bg-yellow-500 hover:bg-yellow-600 text-gray-900 py-2 px-4 rounded-md text-sm">Xem chi tiết</button>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-200 mb-2">Mục 3 - Báo cáo</h4>
                        <p class="text-gray-400 text-sm">Tạo và xem các báo cáo thống kê.</p>
                        <button class="mt-3 bg-yellow-500 hover:bg-yellow-600 text-gray-900 py-2 px-4 rounded-md text-sm">Xem chi tiết</button>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                <h3 class="text-2xl font-semibold text-gray-200 mb-4">Chào mừng đến với Hệ thống xử án RLIFE</h3>
                <p class="text-gray-400">
                    Bạn đã đăng nhập thành công. Đây là trang dành cho người dùng thông thường.
                    Các tính năng quản lý chỉ dành cho tài khoản quản trị viên.
                </p>
                <p class="text-gray-400 mt-2">
                    Nếu bạn là quản trị viên, vui lòng đăng nhập bằng tài khoản quản trị viên của bạn.
                </p>
            </div>
        {% endif %}
    </main>

    <footer class="bg-gray-800 py-4 mt-8">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            © 2025 Hệ thống xử án RLIFE. Bảo lưu mọi quyền.
        </div>
    </footer>

    <!-- Liên kết đến các tệp JavaScript -->
    <script src="{{ url_for('static', filename='js/loading.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notification.js') }}"></script>
</body>
</html>
